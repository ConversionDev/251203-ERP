spring:
  application:
    name: gateway
  cloud:
    config:
      enabled: false
      import-check:
        enabled: false
    
    gateway:
      routes:
        # OAuth Service 라우팅
        - id: oauth-service
          uri: http://oauthservice:8081
          predicates:
            - Path=/auth/**
        
        # OAuth2 Google 콜백 라우팅
        - id: oauth2-google
          uri: http://oauthservice:8081
          predicates:
            - Path=/oauth2/google/**
          filters:
            - RewritePath=/oauth2/google/(?<segment>.*), /auth/google/$\{segment}
        
        # OAuth2 Naver 콜백 라우팅
        - id: oauth2-naver
          uri: http://oauthservice:8081
          predicates:
            - Path=/oauth2/naver/**
          filters:
            - RewritePath=/oauth2/naver/(?<segment>.*), /auth/naver/$\{segment}
        
        # OAuth2 Kakao 콜백 라우팅
        - id: oauth2-kakao
          uri: http://oauthservice:8081
          predicates:
            - Path=/oauth2/kakao/**
          filters:
            - RewritePath=/oauth2/kakao/(?<segment>.*), /auth/kakao/$\{segment}
        
        # User API 라우팅
        - id: user-api
          uri: http://user-service:8082
          predicates:
            - Path=/api/users/**
        
        # User Service Health Check
        - id: user-service-health
          uri: http://user-service:8082
          predicates:
            - Path=/user/**
        
        # AI Crawler Service 라우팅
        - id: ai-crawler
          uri: http://crawler-service:9001
          predicates:
            - Path=/ai/crawler/**
          filters:
            - StripPrefix=1
        
        # AI Chatbot Service 라우팅
        - id: ai-chatbot
          uri: http://chatbot-service:9002
          predicates:
            - Path=/ai/chatbot/**
          filters:
            - StripPrefix=1
        
        # ML Service 라우팅 (Titanic, Customer, Seoul 포함)
        - id: ml-service
          uri: http://mlservice:9002
          predicates:
            - Path=/api/ml/**
          filters:
            - RewritePath=/api/ml/(?<segment>.*), /${segment}
        
        # Review Service 라우팅 (KoELECTRA 감성분석)
        - id: review-service
          uri: http://reviewservice:9004
          predicates:
            - Path=/api/review/**
          filters:
            - RewritePath=/api/review/(?<segment>.*), /${segment}
        
        # ML Service Swagger UI 접근
        - id: ml-service-docs
          uri: http://mlservice:9002
          predicates:
            - Path=/ml/docs/**
          filters:
            - RewritePath=/ml/docs/(?<segment>.*), /docs/${segment}
        
        # ML Service OpenAPI JSON
        - id: ml-service-openapi
          uri: http://mlservice:9002
          predicates:
            - Path=/ml/openapi.json
          filters:
            - RewritePath=/ml/openapi.json, /openapi.json
        
        # Review Service Swagger UI 접근
        - id: review-service-docs
          uri: http://reviewservice:9004
          predicates:
            - Path=/review/docs/**
          filters:
            - RewritePath=/review/docs/(?<segment>.*), /docs/${segment}
        
        # Review Service OpenAPI JSON
        - id: review-service-openapi
          uri: http://reviewservice:9004
          predicates:
            - Path=/review/openapi.json
          filters:
            - RewritePath=/review/openapi.json, /openapi.json
      
      # CORS 설정
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins:
              - "http://localhost:3000"
              - "http://localhost:4000"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders:
              - "*"
            allowCredentials: true
            maxAge: 3600

server:
  port: 8080

# JWT 설정
jwt:
  secret: ${JWT_SECRET}

springdoc:
  api-docs:
    path: /docs/api-docs
    groups:
      enabled: true
  swagger-ui:
    path: /docs
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
    use-root-path: false
    persist-authorization: true
    show-actuator: false
    default-flat-param-object: true
    writer-with-order-by-keys: true
    # 기본 그룹을 "all"로 설정하여 모든 API 표시
    default-group: all
    # 외부 서비스(OpenAPI JSON)를 스웨거 UI에서 직접 선택 가능하도록 등록
    urls:
      - name: Review Service
        url: /review/openapi.json
      # - name: ML Service
      #   url: /ml/openapi.json
      - name: Gateway
        url: /docs/api-docs

management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway,metrics
  endpoint:
    health:
      show-details: always
    gateway:
      enabled: true

# 로깅 설정
logging:
  level:
    root: INFO
    store.kanggyeonggu: DEBUG
    org.springframework.cloud.gateway: INFO
    org.springframework.cloud.loadbalancer: INFO
    io.micrometer: WARN
    io.micrometer.core.instrument: WARN
